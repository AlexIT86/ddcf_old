{% extends "base.html" %}
{% load static %}

{% block title %}Plaje de Numere{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <span>
                <i class="bi bi-body-text admin-icon"></i>
                Plaje de Numere Documente
            </span>
            <a href="{% url 'administrare' %}?tab=documentrange" class="btn btn-sm btn-primary">
             <i class="bi bi-plus-circle-fill"></i> Adaugă Plajă Nouă
            </a>
        </div>
        <div class="card-body p-0">
            {% if ranges_list %} {# Am schimbat 'ranges' in 'ranges_list' pentru a corespunde contextului din view #}
                <div class="table-responsive">
                    <table class="table table-hover table-admin mb-0">
                        <thead>
                            <tr>
                                <th>Gestiune</th>
                                <th>Tipologie Produs</th>
                                <th>Număr Început</th>
                                <th>Număr Final</th>
                                <th>Număr Curent Utilizat</th> {# Etichetă mai clară #}
                                <th>Următorul Număr de Atribuit</th> {# NOUA COLOANĂ #}
                                <th class="text-end">Acțiuni</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for r_data in ranges_list %} {# Iterăm prin lista de dicționare #}
                            <tr>
                                <td>{{ r_data.gestiune_nume }}</td>
                                <td>{{ r_data.tipologie_nume }}</td>
                                <td>{{ r_data.numar_inceput }}</td>
                                <td>{{ r_data.numar_final }}</td>
                                <td>{{ r_data.numar_curent|default:"<span class='text-muted'>--</span>"|safe }}</td>
                                <td class="fw-bold"> {# NOUA CELULĂ #}
                                    {% if r_data.urmatorul_numar == "Range epuizat" %}
                                        <span class="badge bg-danger">{{ r_data.urmatorul_numar }}</span>
                                    {% elif r_data.urmatorul_numar == "Format incompatibil" %}
                                        <span class="badge bg-warning text-dark">{{ r_data.urmatorul_numar }}</span>
                                    {% elif r_data.urmatorul_numar %}
                                        {{ r_data.urmatorul_numar }}
                                    {% else %}
                                        <span class="text-muted">N/A</span>
                                    {% endif %}
                                </td>
                                <td class="text-end">
                                    <a href="{% url 'edit_document_range' r_data.id %}" class="btn btn-sm btn-warning" title="Editează Plaja">
                                        <i class="bi bi-pencil-fill"></i> Editează
                                    </a>
                                    {# Presupunem că r_data.id este pk-ul corect #}
                                    <form method="post" action="{% url 'delete_document_range' r_data.id %}" style="display:inline;">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-sm btn-danger" title="Șterge Plaja" onclick="return confirm('Sigur dorești să ștergi această plajă de numere?');">
                                            <i class="bi bi-trash-fill"></i> Șterge
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="p-4 text-center text-muted">
                    <i class="bi bi-info-circle fs-3 d-block mb-2"></i>
                    Nu s-au găsit plaje de numere definite.
                    {% if user.userprofile.role.name|lower == 'superadmin' or user.userprofile.ok_administrare %}
                     <br>
                     <a href="{% url 'administrare' %}?tab=documentrange" class="btn btn-link mt-2">Adaugă o plajă nouă</a>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}